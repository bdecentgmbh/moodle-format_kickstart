/**
 * Defines Kicstart javascript.
 * @module   format_kickstart/formatkickstart
 * @category  Classes - autoloading
 * @copyright 2021, bdecent gmbh bdecent.de
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("format_kickstart/formatkickstart",["jquery","core/str","core/notification","core/config","core/ajax","core/fragment","core/templates"],(function($,str,notification,Config,Ajax,Fragment,Templates){var Formatkickstart=function(contextid,courseid,menuid,filteroptions){var self=this,useTemplate=document.querySelectorAll(".templates-block .use-template");if(self.contextId=contextid,self.courseId=courseid,self.menuid=menuid,useTemplate&&useTemplate.forEach((element=>{element.addEventListener("click",self.templateHandler.bind(this))})),filteroptions){var templateview=document.querySelectorAll(".kickstart-page .listing-view-block a");templateview&&templateview.forEach((element=>{element.addEventListener("click",self.templateviewHandler.bind(this))}));var templatesearch=document.querySelectorAll(".kickstart-page #search-template");templatesearch&&templatesearch.forEach((element=>{element.addEventListener("change",self.templateSearchHandler.bind(this))}));var librarycourse=document.querySelectorAll(".librarycourse-filter .filter-item");librarycourse&&librarycourse.forEach((element=>{element.addEventListener("change",self.libraryCourseHandler.bind(this))}))}$("body").delegate(self.fullDescription,"click",self.fullmodcontentHandler.bind(this)),$("body").delegate(self.trimDescription,"click",self.trimmodcontentHandler.bind(this))};Formatkickstart.prototype.confirmbutton=".buttons .singlebutton form button",Formatkickstart.prototype.loadiconElement="#modal-footer span#load-action",Formatkickstart.prototype.fullDescription=".list-library-courses .trim-summary .section-summary-action",Formatkickstart.prototype.trimDescription=".list-library-courses .fullcontent-summary .section-summary-action",Formatkickstart.prototype.contextId=null,Formatkickstart.prototype.courseId=null,Formatkickstart.prototype.menuid=null,Formatkickstart.prototype.fullmodcontentHandler=function(event){var THIS=$(event.currentTarget);let fullContent=$(THIS).closest(".accordion-item").find(".fullcontent-summary"),trimcontent=$(THIS).closest(".accordion-item").find(".trim-summary");trimcontent.hasClass("summary-hide")&&(trimcontent.removeClass("summary-hide"),fullContent.addClass("summary-hide"))},Formatkickstart.prototype.trimmodcontentHandler=function(event){var THIS=$(event.currentTarget);let fullContent=$(THIS).closest(".accordion-item").find(".fullcontent-summary"),trimcontent=$(THIS).closest(".accordion-item").find(".trim-summary");fullContent.hasClass("summary-hide")&&(fullContent.removeClass("summary-hide"),trimcontent.addClass("summary-hide"))},Formatkickstart.prototype.libraryCourseHandler=function(event){let searchcourse=document.querySelector("#search-course-library").value,customfieldsitems=document.querySelectorAll(".librarycourse-filter .customfield-filter .filter-item"),customvalues={};customfieldsitems&&customfieldsitems.forEach((element=>{customvalues[element.getAttribute("data-value")]=element.value})),this.getlibarycourse(searchcourse,customvalues)},Formatkickstart.prototype.getlibarycourse=function(searchcourse,customvalues){let courselist=document.querySelector(".list-library-courses");if(courselist){let self=this,args={contextid:self.contextId,courseid:self.courseId,menuid:self.menuid,searchcourse:searchcourse,customvalues:JSON.stringify(customvalues)};Fragment.loadFragment("format_kickstart","get_library_courselist",self.contextId,args).then(((html,js)=>{Templates.replaceNode(courselist,html,js)})).catch()}},Formatkickstart.prototype.getKickstartTemplate=function(action,value){let templatelist=document.querySelector(".template-list"),searchBox=document.querySelector(".kickstart-page #search-template"),searchvalue=null!=searchBox?searchBox.value:"";if(templatelist){let self=this,args={contextid:self.contextId,courseid:self.courseId,menuid:self.menuid,action:action,value:value,search:searchvalue};Fragment.loadFragment("format_kickstart","get_kickstart_templatelist",self.contextId,args).then(((html,js)=>{Templates.replaceNode(templatelist,html,js)})).catch()}},Formatkickstart.prototype.templateSearchHandler=function(event){let value=event.currentTarget.value;this.getKickstartTemplate("searchtemplate",value)},Formatkickstart.prototype.templateviewHandler=function(event){let value=event.currentTarget.getAttribute("data-value");const tileView=document.getElementById("tile-view"),listView=document.getElementById("list-view");"tile"===value?(tileView.classList.add("active"),listView.classList.remove("active")):(listView.classList.add("active"),tileView.classList.remove("active")),this.getKickstartTemplate("changetemplate",value)},Formatkickstart.prototype.templateHandler=function(event){event.preventDefault();let templateName=event.target.getAttribute("data-templatename"),templateId=event.target.getAttribute("data-template");this.confirmImportTemplate(templateId,templateName)},Formatkickstart.prototype.confirmImportTemplate=function(templateId,templateName){let self=this;var plugindata={name:templateName};str.get_strings([{key:"confirm",component:"core"},{key:"confirmtemplate",param:plugindata,component:"format_kickstart"},{key:"import"},{key:"no"}]).done((function(s){notification.confirm(s[0],s[1],s[2],s[3],(function(){document.querySelectorAll("body")[0].classList.add("kickstart-icon"),Ajax.call([{methodname:"format_kickstart_import_template",args:{templateid:templateId,courseid:self.courseId},done:function(response){if(response){let redirect=Config.wwwroot+"/course/view.php?id="+self.courseId;window.location.assign(redirect)}}}])}))}))};return{init:function(contextid,courseid,menuid,filteroptions){return new Formatkickstart(contextid,courseid,menuid,filteroptions)},instanceMenuLink:function(){(navMenu=>{if(null!==navMenu){var menu=navMenu.querySelector("a.kickstart-nav");if(null!==menu){(menu=menu.parentNode).dataset.forceintomoremenu=!1,menu.querySelector("a").classList.remove("dropdown-item"),menu.querySelector("a").classList.add("nav-link"),menu.parentNode.removeChild(menu);var moreMenu=navMenu.querySelector("li.dropdownmoremenu a.dropdown-toggle");moreMenu&&moreMenu.classList.remove("active"),navMenu.insertBefore(menu,navMenu.children[1]),window.dispatchEvent(new Event("resize"))}}})(document.querySelector(".secondary-navigation ul.more-nav"))}}}));

//# sourceMappingURL=formatkickstart.min.js.map