{"version":3,"file":"formatkickstart.min.js","sources":["../src/formatkickstart.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Defines Kicstart javascript.\r\n * @module   format_kickstart/formatkickstart\r\n * @category  Classes - autoloading\r\n * @copyright 2021, bdecent gmbh bdecent.de\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n define(['jquery', 'core/str', 'core/notification', 'core/config', 'core/ajax', 'core/fragment', 'core/templates'],\r\n function($, str, notification, Config, Ajax, Fragment, Templates) {\r\n\r\n    /**\r\n     * Controls kicstart javascript.\r\n     * @param {int} contextid\r\n     * @param {int} courseid\r\n     * @param {int} menuid\r\n     * @return {void}\r\n    */\r\n    var Formatkickstart = function(contextid, courseid, menuid, filteroptions) {\r\n        var self = this;\r\n        var useTemplate = document.querySelectorAll(\".templates-block .use-template\");\r\n        self.contextId = contextid;\r\n        self.courseId = courseid;\r\n        self.menuid = menuid;\r\n        if (useTemplate) {\r\n            useTemplate.forEach((element) => {\r\n                element.addEventListener('click', self.templateHandler.bind(this));\r\n            });\r\n        }\r\n\r\n        if (filteroptions) {\r\n\r\n            var templateview = document.querySelectorAll(\".kickstart-page .listing-view-block a\");\r\n            if (templateview) {\r\n                templateview.forEach((element) => {\r\n                    element.addEventListener('click', self.templateviewHandler.bind(this));\r\n                });\r\n            }\r\n\r\n\r\n            var templatesearch = document.querySelectorAll(\".kickstart-page #search-template\");\r\n            if (templatesearch) {\r\n                templatesearch.forEach((element) => {\r\n                    element.addEventListener('change', self.templateSearchHandler.bind(this));\r\n                });\r\n            }\r\n\r\n            var librarycourse = document.querySelectorAll(\".librarycourse-filter .filter-item\");\r\n            if (librarycourse) {\r\n                librarycourse.forEach((element) => {\r\n                    element.addEventListener('change', self.libraryCourseHandler.bind(this));\r\n                });\r\n            }\r\n        }\r\n\r\n        $('body').delegate(self.fullDescription, \"click\", self.fullmodcontentHandler.bind(this));\r\n        $('body').delegate(self.trimDescription, \"click\", self.trimmodcontentHandler.bind(this));\r\n\r\n    };\r\n\r\n\r\n    Formatkickstart.prototype.confirmbutton = \".buttons .singlebutton form button\";\r\n\r\n    Formatkickstart.prototype.loadiconElement = \"#modal-footer span#load-action\";\r\n\r\n    Formatkickstart.prototype.fullDescription = \".list-library-courses .trim-summary .section-summary-action\";\r\n\r\n    Formatkickstart.prototype.trimDescription = \".list-library-courses .fullcontent-summary .section-summary-action\";\r\n\r\n    Formatkickstart.prototype.contextId = null;\r\n\r\n    Formatkickstart.prototype.courseId = null;\r\n\r\n    Formatkickstart.prototype.menuid = null;\r\n\r\n\r\n    Formatkickstart.prototype.fullmodcontentHandler = function(event) {\r\n        var THIS = $(event.currentTarget);\r\n        let fullContent = $(THIS).closest('.accordion-item').find('.fullcontent-summary');\r\n        let trimcontent = $(THIS).closest('.accordion-item').find('.trim-summary');\r\n        if (trimcontent.hasClass('summary-hide')) {\r\n            trimcontent.removeClass('summary-hide');\r\n            fullContent.addClass('summary-hide');\r\n        }\r\n    };\r\n\r\n    Formatkickstart.prototype.trimmodcontentHandler = function(event) {\r\n        var THIS = $(event.currentTarget);\r\n        let fullContent = $(THIS).closest('.accordion-item').find('.fullcontent-summary');\r\n        let trimcontent = $(THIS).closest('.accordion-item').find('.trim-summary');\r\n        if (fullContent.hasClass('summary-hide')) {\r\n            fullContent.removeClass('summary-hide');\r\n            trimcontent.addClass('summary-hide');\r\n        }\r\n    };\r\n\r\n    Formatkickstart.prototype.libraryCourseHandler = function(event) {\r\n        let searchcourse = document.querySelector(\"#search-course-library\").value;\r\n        let customfieldsitems = document.querySelectorAll(\".librarycourse-filter .customfield-filter .filter-item\");\r\n        let customvalues = {};\r\n        if (customfieldsitems) {\r\n            customfieldsitems.forEach((element) => {\r\n                customvalues[element.getAttribute(\"data-value\")] = element.value;\r\n            });\r\n        }\r\n        this.getlibarycourse(searchcourse, customvalues);\r\n    };\r\n\r\n\r\n    Formatkickstart.prototype.getlibarycourse = function(searchcourse, customvalues) {\r\n        let courselist = document.querySelector(\".list-library-courses\");\r\n        if (courselist) {\r\n            let self = this;\r\n            let args = {\r\n                contextid: self.contextId,\r\n                courseid: self.courseId,\r\n                menuid: self.menuid,\r\n                searchcourse: searchcourse,\r\n                customvalues : JSON.stringify(customvalues),\r\n            };\r\n\r\n            const promise = Fragment.loadFragment(\r\n                'format_kickstart',\r\n                'get_library_courselist',\r\n                self.contextId,\r\n                args\r\n            );\r\n\r\n            promise.then((html, js) => {\r\n                Templates.replaceNode(courselist, html, js);\r\n            }).catch();\r\n        }\r\n    };\r\n\r\n    Formatkickstart.prototype.getKickstartTemplate = function(action, value) {\r\n        let templatelist = document.querySelector(\".template-list\");\r\n        let searchBox = document.querySelector(\".kickstart-page #search-template\");\r\n        let searchvalue = (searchBox != undefined) ? searchBox.value : '';\r\n        if (templatelist) {\r\n            let self = this;\r\n            let args = {\r\n                contextid: self.contextId,\r\n                courseid: self.courseId,\r\n                menuid: self.menuid,\r\n                action: action,\r\n                value: value,\r\n                search: searchvalue,\r\n            };\r\n\r\n            const promise = Fragment.loadFragment(\r\n                'format_kickstart',\r\n                'get_kickstart_templatelist',\r\n                self.contextId,\r\n                args\r\n            );\r\n\r\n            promise.then((html, js) => {\r\n                Templates.replaceNode(templatelist, html, js);\r\n            }).catch();\r\n        }\r\n    };\r\n\r\n    Formatkickstart.prototype.templateSearchHandler = function(event) {\r\n        let value = event.currentTarget.value;\r\n        this.getKickstartTemplate('searchtemplate', value);\r\n    };\r\n\r\n    Formatkickstart.prototype.templateviewHandler = function(event) {\r\n        let value = event.currentTarget.getAttribute(\"data-value\");\r\n        const tileView = document.getElementById('tile-view');\r\n        const listView = document.getElementById('list-view');\r\n\r\n        if (value === 'tile') {\r\n            tileView.classList.add('active');\r\n            listView.classList.remove('active');\r\n        } else {\r\n            listView.classList.add('active');\r\n            tileView.classList.remove('active');\r\n        }\r\n        this.getKickstartTemplate('changetemplate', value);\r\n    };\r\n\r\n    Formatkickstart.prototype.templateHandler = function(event) {\r\n        var self = this;\r\n        event.preventDefault();\r\n        let templateName = event.target.getAttribute(\"data-templatename\");\r\n        let templateId = event.target.getAttribute(\"data-template\");\r\n        self.confirmImportTemplate(templateId, templateName);\r\n    };\r\n\r\n    Formatkickstart.prototype.confirmImportTemplate = function(templateId, templateName) {\r\n        let self = this;\r\n        var plugindata = {\r\n            name: templateName\r\n        };\r\n        str.get_strings([\r\n            {key: 'confirm', component: 'core'},\r\n            {key: 'confirmtemplate', param: plugindata, component: 'format_kickstart'},\r\n            {key: 'import'},\r\n            {key: 'no'}\r\n        ]).done(function(s) {\r\n                notification.confirm(s[0], s[1], s[2], s[3], function() {\r\n                    document.querySelectorAll(\"body\")[0].classList.add(\"kickstart-icon\");\r\n                    Ajax.call([{\r\n                        methodname: 'format_kickstart_import_template',\r\n                        args: {templateid: templateId, courseid: self.courseId},\r\n                        done: function(response) {\r\n                            if (response) {\r\n                                let redirect = Config.wwwroot + \"/course/view.php?id=\" + self.courseId;\r\n                                window.location.assign(redirect);\r\n                            }\r\n                        }\r\n                    }]);\r\n                });\r\n            }\r\n        );\r\n    };\r\n\r\n    const moveOutMoreMenu = (navMenu) => {\r\n\r\n        if (navMenu === null) {\r\n            return;\r\n        }\r\n\r\n        var menu = navMenu.querySelector('a.kickstart-nav');\r\n\r\n        if (menu === null) {\r\n            return;\r\n        }\r\n\r\n        menu = menu.parentNode;\r\n        menu.dataset.forceintomoremenu = false;\r\n        menu.querySelector('a').classList.remove('dropdown-item');\r\n        menu.querySelector('a').classList.add('nav-link');\r\n        menu.parentNode.removeChild(menu);\r\n\r\n        var moreMenu = navMenu.querySelector('li.dropdownmoremenu a.dropdown-toggle');\r\n        if (moreMenu) {\r\n            moreMenu.classList.remove('active');\r\n        }\r\n\r\n        // Insert the stored menus before the more menu.\r\n        navMenu.insertBefore(menu, navMenu.children[1]);\r\n        window.dispatchEvent(new Event('resize')); // Dispatch the resize event to create more menu.\r\n    };\r\n\r\n    return {\r\n        init: function(contextid, courseid, menuid, filteroptions) {\r\n            return new Formatkickstart(contextid, courseid, menuid, filteroptions);\r\n        },\r\n\r\n        instanceMenuLink: function () {\r\n            var primaryNav = document.querySelector('.secondary-navigation ul.more-nav');\r\n            moveOutMoreMenu(primaryNav);\r\n        },\r\n    };\r\n});"],"names":["define","$","str","notification","Config","Ajax","Fragment","Templates","Formatkickstart","contextid","courseid","menuid","filteroptions","self","this","useTemplate","document","querySelectorAll","contextId","courseId","forEach","element","addEventListener","templateHandler","bind","templateview","templateviewHandler","templatesearch","templateSearchHandler","librarycourse","libraryCourseHandler","delegate","fullDescription","fullmodcontentHandler","trimDescription","trimmodcontentHandler","prototype","confirmbutton","loadiconElement","event","THIS","currentTarget","fullContent","closest","find","trimcontent","hasClass","removeClass","addClass","searchcourse","querySelector","value","customfieldsitems","customvalues","getAttribute","getlibarycourse","courselist","args","JSON","stringify","loadFragment","then","html","js","replaceNode","catch","getKickstartTemplate","action","templatelist","searchBox","searchvalue","undefined","search","tileView","getElementById","listView","classList","add","remove","preventDefault","templateName","target","templateId","confirmImportTemplate","plugindata","name","get_strings","key","component","param","done","s","confirm","call","methodname","templateid","response","redirect","wwwroot","window","location","assign","init","instanceMenuLink","navMenu","menu","parentNode","dataset","forceintomoremenu","removeChild","moreMenu","insertBefore","children","dispatchEvent","Event","moveOutMoreMenu"],"mappings":"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"}